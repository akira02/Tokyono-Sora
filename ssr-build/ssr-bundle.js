module.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="./",n(n.s="QfWi")}({HteQ:function(t,e){t.exports=require("preact")},QfWi:function(t,e,n){"use strict";n.r(e);var r,o,i,c=n("HteQ"),u=0,a=[],l=c.options.__b,s=c.options.__r,f=c.options.diffed,_=c.options.__c,h=c.options.unmount;function b(t,e){c.options.__h&&c.options.__h(o,t,u||e),u=0;var n=o.__H||(o.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function m(t){return u=1,function(t,e,n){var i=b(r++,2);return i.t=t,i.__c||(i.__=[n?n(e):v(void 0,e),function(t){var e=i.t(i.__[0],t);i.__[0]!==e&&(i.__=[e,i.__[1]],i.__c.setState({}))}],i.__c=o),i.__}(v,t)}function p(t,e){var n=b(r++,7);return j(n.__H,e)&&(n.__=t(),n.__H=e,n.__h=t),n.__}function d(){a.forEach((function(t){if(t.__P)try{t.__H.__h.forEach(E),t.__H.__h.forEach(O),t.__H.__h=[]}catch(e){t.__H.__h=[],c.options.__e(e,t.__v)}})),a=[]}c.options.__b=function(t){o=null,l&&l(t)},c.options.__r=function(t){s&&s(t),r=0;var e=(o=t.__c).__H;e&&(e.__h.forEach(E),e.__h.forEach(O),e.__h=[])},c.options.diffed=function(t){f&&f(t);var e=t.__c;e&&e.__H&&e.__H.__h.length&&(1!==a.push(e)&&i===c.options.requestAnimationFrame||((i=c.options.requestAnimationFrame)||function(t){var e,n=function(){clearTimeout(r),g&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,100);g&&(e=requestAnimationFrame(n))})(d)),o=void 0},c.options.__c=function(t,e){e.some((function(t){try{t.__h.forEach(E),t.__h=t.__h.filter((function(t){return!t.__||O(t)}))}catch(n){e.some((function(t){t.__h&&(t.__h=[])})),e=[],c.options.__e(n,t.__v)}})),_&&_(t,e)},c.options.unmount=function(t){h&&h(t);var e=t.__c;if(e&&e.__H)try{e.__H.__.forEach(E)}catch(t){c.options.__e(t,e.__v)}};var g="function"==typeof requestAnimationFrame;function E(t){var e=o;"function"==typeof t.__c&&t.__c(),o=e}function O(t){var e=o;t.__c=t.__(),o=e}function j(t,e){return!t||t.length!==e.length||e.some((function(e,n){return e!==t[n]}))}function v(t,e){return"function"==typeof e?e(t):e}const T=new DataView(new ArrayBuffer(8));function R(t){const e=t>=0?1:-1;if(t=Math.abs(t),isNaN(t))return NaN;if(t===1/0)return 1*e;T.setFloat64(0,t);const n=T.getInt32(0);if(n<1072365568){if(n<1043333120)return n<8388608?e*(.125*(8*t+1.0270333367641007*t)):e*(t+.1283791670955126*t);const r=t*t;return e*(t+t*((.12837916709551256+r*(r*(r*(-23763016656650163e-21*r-.005770270296489442)-.02848174957559851)-.3250421072470015))/(1+r*(.39791722395915535+r*(.0650222499887673+r*(.005081306281875766+r*(.00013249473800432164+-3960228278775368e-21*r)))))))}if(n<1072955392){const n=t-1;return e*(.8450629115104675+(n*(.41485611868374833+n*(n*(.31834661990116175+n*(n*(.035478304325618236+-.002166375594868791*n)-.11089469428239668))-.3722078760357013))-.0023621185607526594)/(1+n*(.10642088040084423+n*(.540397917702171+n*(.07182865441419627+n*(.12617121980876164+n*(.01363708391202905+.011984499846799107*n)))))))}if(n>=1075314688)return 1*e;const r=1/(t*t);let o,i;n<1074191214?(o=r*(r*(r*(r*(r*(r*(-9.814329344169145*r-81.2874355063066)-184.60509290671104)-162.39666946257347)-62.375332450326006)-10.558626225323291)-.6938585727071818)-.009864944034847148,i=1+r*(19.651271667439257+r*(137.65775414351904+r*(434.56587747522923+r*(645.3872717332679+r*(429.00814002756783+r*(108.63500554177944+r*(6.570249770319282+-.0604244152148581*r)))))))):(o=r*(r*(r*(r*(r*(-483.5191916086514*r-1025.0951316110772)-637.5664433683896)-160.63638485582192)-17.757954917754752)-.799283237680523)-.0098649429247001,i=1+r*(30.33806074348246+r*(325.7925129965739+r*(1536.729586084437+r*(3199.8582195085955+r*(2553.0504064331644+r*(474.52854120695537+-22.44095244658582*r))))))),T.setInt32(4,0);const c=T.getFloat64(0);return e*(1-Math.exp(-c*c-.5625)*Math.exp((c-t)*(c+t)+o/i)/t)}function y(t,e){const n=R((t-.5)/(e*Math.SQRT2));return(R((t+.5)/(e*Math.SQRT2))-n)/2}function P(t){return["\n    precision highp float;\n    attribute vec2 a_position;\n    void main() {\n      gl_Position = vec4(a_position, 0.0, 1.0);\n    }\n  ",`\n    precision mediump float;\n    uniform sampler2D u_texture;\n    uniform highp vec2 u_shape;\n    uniform highp vec2 u_blurDirection;\n    uniform vec4 u_mixColor;\n    void main() {\n      gl_FragColor = vec4(0.0);\n      ${function(t){const e=[];e.push({offset:0,weight:y(0,t)});const n=Math.ceil(3*t);for(let r=1;r<=n;r+=2){const n=y(r,t),o=y(r+1,t),i=(n*r+o*(r+1))/(n+o),c=n+o;e.push({offset:i,weight:c}),e.push({offset:-i,weight:c})}return e}(t.blur).map(({offset:t,weight:e})=>`gl_FragColor += texture2D(u_texture, ${`(gl_FragCoord.xy + u_blurDirection * ${t.toExponential()}) / u_shape`}) * ${e.toExponential()};`).join("\n")}\n      gl_FragColor = vec4(mix(gl_FragColor.rgb, u_mixColor.rgb, u_mixColor.a), 1.0);\n    }\n  `]}const w=new Float32Array([-1,1,-1,-1,1,1,1,1,-1,-1,1,-1]);function U(t,e){const{width:n,height:r}=t,o=document.createElement("canvas");o.width=n,o.height=r;const i=o.getContext("webgl",{depth:!1,antialias:!1});i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0);const c=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,c),i.bufferData(i.ARRAY_BUFFER,w,i.STATIC_DRAW);const u=i.createTexture();i.bindTexture(i.TEXTURE_2D,u),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t);const a=i.createTexture();i.bindTexture(i.TEXTURE_2D,a),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,r,0,i.RGBA,i.UNSIGNED_BYTE,null);const l=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,l),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,a,0);const[s,f]=P(e),_=i.createShader(i.VERTEX_SHADER);i.shaderSource(_,s),x(i,_);const h=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(h,f),x(i,h);const b=i.createProgram();i.attachShader(b,_),i.attachShader(b,h),function(t,e){t.linkProgram(e);if(!t.getProgramParameter(e,t.LINK_STATUS))throw new Error(t.getProgramInfoLog(e))}(i,b),i.useProgram(b);const m=i.getAttribLocation(b,"a_position"),p=i.getUniformLocation(b,"u_texture"),d=i.getUniformLocation(b,"u_shape"),g=i.getUniformLocation(b,"u_blurDirection"),E=i.getUniformLocation(b,"u_mixColor");return i.enableVertexAttribArray(m),i.bindBuffer(i.ARRAY_BUFFER,c),i.vertexAttribPointer(m,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.uniform1i(p,0),i.uniform2fv(d,[n,r]),i.bindFramebuffer(i.FRAMEBUFFER,l),i.bindTexture(i.TEXTURE_2D,u),i.uniform2fv(g,[1,0]),i.uniform4fv(E,[0,0,0,0]),i.drawArrays(i.TRIANGLES,0,6),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindTexture(i.TEXTURE_2D,a),i.uniform2fv(g,[0,1]),i.uniform4fv(E,e.mixColor),i.drawArrays(i.TRIANGLES,0,6),new Promise(t=>{o.toBlob(t,"image/jpeg")})}function x(t,e){t.compileShader(e);if(!t.getShaderParameter(e,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(e));return e}function A(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?A(Object(n),!0).forEach((function(e){L(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function L(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function D({defaultType:t="url",name:e}){const[n,r]=m(t);return Object(c.h)("div",{class:"form-group"},Object(c.h)("div",{class:"input-group"},Object(c.h)("span",{class:"input-group-btn"},Object(c.h)("select",{name:e+"-type",class:"btn",value:n,onChange:t=>r(t.target.value)},Object(c.h)("option",{value:"url"},"URL"),Object(c.h)("option",{value:"file"},"檔案/ファイル"))),Object(c.h)("input",{type:n,name:e,class:"form-control",required:"required"})))}function S(t,e){return{type:t.get(e+"-type"),value:t.get(e)}}function k({name:t,defaultBlur:e,defaultBrightness:n}){return Object(c.h)("div",{class:"form-group"},Object(c.h)("label",null,"亮度 Brightness"),Object(c.h)("input",{type:"range",name:t+"-brightness",min:"-100",max:"100",defaultValue:n}),Object(c.h)("label",null,"模糊 Blur"),Object(c.h)("input",{type:"range",name:t+"-blur",min:"0",max:"1000",defaultValue:e}))}function C(t,e){const n=parseInt(t.get(e+"-brightness"))/100;return{blur:parseInt(t.get(e+"-blur"))/100,mixColor:n>0?[1,1,1,n]:[0,0,0,-n]}}function I({onSubmit:t}){return Object(c.h)(c.Fragment,null,Object(c.h)("h2",null,"Step.1 設定"),Object(c.h)("span",null,"先選擇你要的背景圖，設定好你喜歡的明暗透明度、模糊程度並預覽"),Object(c.h)("form",{onSubmit:e=>{e.preventDefault();const n=new FormData(e.target);t({image:S(n,"image-input"),options:{plurk:C(n,"plurk")}})}},Object(c.h)("h3",null,"背景画像選択"),Object(c.h)(D,{name:"image-input"}),Object(c.h)("h3",null,"模糊與透明程度調整"),Object(c.h)(k,{name:"plurk",defaultBrightness:"80",defaultBlur:"500"}),Object(c.h)("h2",null,"Step.2 預覽"),Object(c.h)("span",null,"暫不支援即時預覽，更改數值之後要再點一次計算模糊圖片喔"),Object(c.h)("br",null),Object(c.h)("button",{type:"submit",class:"btn btn-primary"},"計算Preview")))}function M({images:t}){return Object(c.h)(c.Fragment,null,Object(c.h)("div",{class:"preview background-timeline",style:t?`background-image: url(${t.timeline.objectURL})`:""},Object(c.h)("div",{class:"preview-box background-plurk",style:t?`background-image: url(${t.plurk.objectURL})`:""},Object(c.h)("b",null,"千秋"),Object(c.h)("span",{class:"say"},Object(c.h)("b",null,"說")),Object(c.h)("br",null),"你好，謝謝你的使用OwO"),Object(c.h)("div",{class:"preview-box background-plurk",style:t?`background-image: url(${t.plurk.objectURL})`:""},Object(c.h)("b",{style:"color:#63C6D3;"},"涼風青葉"),Object(c.h)("span",{class:"say"},Object(c.h)("b",null,"說")),Object(c.h)("br",null),"這是淺色暱稱的狀況")))}function B({images:t,onDone:e}){const[n,r]=m(!1),o=null!=t&&!n;return Object(c.h)(c.Fragment,null,Object(c.h)("h2",null,"Step.3 上傳圖片"),Object(c.h)("button",{type:"button",class:"btn btn-primary",onClick:()=>new Promise((function(n,i){var c=function(t){return function(e){try{return r(!1),t&&t.call(this,e)}catch(t){return i(t)}}.bind(this)}.bind(this);if(!o)return n();r(!0);var u=function(){try{return n()}catch(t){return i(t)}},a=function(t){try{return console.error(t),alert("上傳失敗"),c(u)()}catch(t){return c(i)(t)}};try{let n;return n={},Promise.resolve(Promise.all(Object.keys(t).map(e=>new Promise((function(r,o){return Promise.resolve((i=t[e].blob,new Promise((function(t,e){let n,r,o;return n=new FormData,n.append("image",i),Promise.resolve(fetch("https://api.imgur.com/3/image.json",{method:"POST",headers:{Authorization:"Client-ID f28cb80465f9e25"},body:n})).then((function(n){try{return r=n,Promise.resolve(r.json()).then((function(n){try{return o=n,o.success?t(o.data.link):e(new Error(o.data.error))}catch(t){return e(t)}}),e)}catch(t){return e(t)}}),e)})))).then((function(t){try{return n[e]=t,r()}catch(t){return o(t)}}),o);var i}))))).then((function(t){try{return e(n),c(u)()}catch(t){return a(t)}}),a)}catch(t){a(t)}})),disabled:!o},"上傳產生CSS"),Object(c.h)("br",null),Object(c.h)("span",null,"要等蠻久的，好了我會彈個提示 ",Object(c.h)("br",null),"Please wait",Object(c.h)("br",null)))}function X({css:t}){const e=(n=null,u=5,p((function(){return{current:n}}),[]));var n;return Object(c.h)(c.Fragment,null,Object(c.h)("textarea",{ref:e,class:"form-control",style:"max-height: 500px"},t),Object(c.h)("button",{type:"button",class:"btn btn-default",onClick:()=>{e.current.select(),document.execCommand("copy")}},"點我複製"))}function N(t){return new Promise((function(e,n){let r,o,i,c;return Promise.resolve(function({type:t,value:e}){return new Promise((function(n,r){return"url"===t?n(fetch(e,{mode:"cors"}).then(t=>t.blob())):"file"===t?n(e):n()}))}(t.image)).then((function(u){try{return r=u,Promise.resolve((a=r,new Promise((function(t,e){var n=function(t){return function(n){try{return URL.revokeObjectURL(r),t&&t.call(this,n)}catch(t){return e(t)}}.bind(this)}.bind(this);let r;r=URL.createObjectURL(a);var o=function(t){try{throw t}catch(t){return n(e)(t)}};try{let e;return e=new Image,e.decode?(e.src=r,Promise.resolve(e.decode()).then(function(t){try{return i.call(this)}catch(t){return o(t)}}.bind(this),o)):Promise.resolve(new Promise((t,n)=>{e.onload=t,e.onerror=n,e.src=r})).then(function(t){try{return i.call(this)}catch(t){return o(t)}}.bind(this),o);function i(){return n(t)(e)}}catch(t){o(t)}})))).then((function(u){try{return o=u,i=Math.min(o.width,o.height)/200,c={},c.timeline={blob:r,objectURL:URL.createObjectURL(r)},Promise.resolve(Promise.all(["plurk"].map(e=>new Promise((function(n,r){let u,a;return u=t.options[e],Promise.resolve(U(o,F(F({},u),{},{blur:u.blur*i}))).then((function(t){try{return a=t,c[e]={blob:a,objectURL:URL.createObjectURL(a)},n()}catch(t){return r(t)}}),r)}))))).then((function(t){try{return e(c)}catch(t){return n(t)}}),n)}catch(t){return n(t)}}),n)}catch(t){return n(t)}var a}),n)}))}e.default=function(){const[t,e]=m(null),[n,r]=m("");return Object(c.h)("div",{class:"root",style:t?`background-image: url(${t.timeline.objectURL})`:""},Object(c.h)("div",{class:"container",style:t?`background-image: url(${t.plurk.objectURL})`:""},Object(c.h)("h1",null,"Tokyono Sora 噗文模糊背景產生器 ",Object(c.h)("small",null,"beta")),Object(c.h)("hr",null),Object(c.h)("div",{class:"row"},Object(c.h)("div",{class:"col-md-6"},Object(c.h)(I,{onSubmit:t=>new Promise((function(n,o){var i=function(){try{return n()}catch(t){return o(t)}},c=function(t){try{return console.error(t),alert("失敗：錯誤"+t),i()}catch(t){return o(t)}};try{let n;return r(""),Promise.resolve(N(t)).then((function(t){try{return n=t,e(t=>(function(t){if(null!=t)for(const e in t)URL.revokeObjectURL(t[e].objectURL)}(t),n)),i()}catch(t){return c(t)}}),c)}catch(t){c(t)}}))})),Object(c.h)("div",{class:"col-md-6"},Object(c.h)(M,{images:t}),Object(c.h)(B,{images:t,onDone:t=>new Promise((function(e,n){return r(function(t,e){return function(t){return`/* 以上傳圖片覆蓋掉噗浪原本的背景圖 */\n._lch_ {\n  background-image: url(${t.timeline}) !important;\n  background-position: center !important;\n  background-size: cover !important;\n  background-attachment: fixed !important;\n  backdrop-filter: none !important;\n}\n/* 若想保留噗浪原本的背景圖請刪除上面這段 */\n\n/* 白色模糊背景改為固定圖片 */\n.cboxAnchor:not(.response) .plurk_cnt,\n#form_holder,\n._lch_~.pop-window .pop-window-content,\n._lch_~.pop-window .pop-window-view iframe  {\n  background-image: url(${t.plurk}) !important;\n  background-position: center !important;\n  background-size: cover !important;\n  background-attachment: fixed !important;\n  backdrop-filter: none !important;\n}`}(e)}(0,t)),e()}))}),Object(c.h)(X,{css:n}),Object(c.h)("a",{href:"https://www.plurk.com/akira02/invite/4",class:"btn btn-outline-danger",role:"button"},"喜歡請追蹤千秋的噗浪<3",Object(c.h)("br",null),"フォローしてください"),Object(c.h)("a",{href:"https://www.plurk.com/egg820/invite/4",class:"btn btn-outline-danger",role:"button"},"技術支援",Object(c.h)("br",null),"欸個")))))}}});
//# sourceMappingURL=ssr-bundle.js.map